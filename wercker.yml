box: node
build:
  steps:
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"
    - npm-install
    - npm-test

deploy:
   aws:
    - add-ssh-key:
        keyname: KEY_PRIVATE
        host: $HOST
    - add-to-known_hosts:
        hostname: $HOST
    - script:
        name: ssh stop
        code: |
          ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $USER@$HOST pm2 stop index
    - script:
        name: clone start
        code: |
          ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $USER@$HOST rm -rf aws-test
          ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $USER@$HOST git clone $GIT_REPO_URL aws-test
          ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $USER@$HOST cd aws-test && npm install
          ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $USER@$HOST cd aws-test && pm2 start index.js